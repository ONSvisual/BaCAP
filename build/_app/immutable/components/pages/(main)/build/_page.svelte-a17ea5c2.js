import{S as ta,i as la,s as sa,k as f,v as ke,q as J,a as A,l as _,m as g,w as Ce,r as X,h as p,c as P,n as w,L as xe,b as le,F as o,x as Te,M as ve,N as Y,O as na,f as ce,t as be,d as oa,u as Ye,y as Ae,P as ra,Q as Ze,o as ia,R as ha,T as ua,p as Ie,g as ca,U as pa}from"../../../../chunks/index-64a06eee.js";import{I as Pe,t as ma,s as da,g as fa,a as _a,d as va,c as ba}from"../../../../chunks/functions-e18afbcc.js";import{b as ga}from"../../../../chunks/paths-6cd3a76e.js";import{p as Na}from"../../../../chunks/pym.v1-f680678d.js";const ya={index:[0,1,2,3],"Table name":["Population","Density","Sex","Sex"],"Source table":"KS101EW","Nomis table":"NM_144_1","Cell no":[0,7,1,2],"Cell name":["Total population","Population density","Male","Female"],Unit:["people","people per hectare","people","people"]},Ea={index:4,"Table name":"Median age","Source table":"KS102EW","Nomis table":"NM_145_1","Cell no":[18],"Cell name":["Median age"],Unit:"years"},wa={index:[5,6,7,8,9],"Table name":"Ethnic group","Source table":"QS201EW","Nomis table":"NM_522_1","Cell no":[100,200,300,400,500],"Cell name":["White","Mixed/multiple ethnic groups","Asian/Asian British","Black/African/Caribbean/Black British","Other ethnic group"],Unit:"people"},Sa={index:[10,11,12,13,14,15,16,17,18],"Table name":"Religion","Source table":"QS208EW","Nomis table":"NM_529_1","Cell no":[1,2,3,4,5,6,7,8,9],"Cell name":["Christian","Buddhist","Hindu","Jewish","Muslim","Sikh","Other religion","No religion","Religion not stated"],Unit:"people"},Ma={index:[19,20,21,22,23],"Table name":"General health","Source table":"QS302EW","Nomis table":"NM_531_1","Cell no":[1,2,3,4,5],"Cell name":["Very good health","Good health","Fair health","Bad health","Very bad health"],Unit:"people"},ka={index:[24,25,26,27],"Table name":"Housing type","Source table":"QS402EW","Nomis table":"NM_534_1","Cell no":[2,6,10,11],"Cell name":["Whole house or bungalow","Flat, maisonette or apartment","Caravan/mobile home/temporary structure","Shared dwelling"],Unit:"households"},Ca={index:[28,29,30,31,32],"Table name":"Housing tenure","Source table":"QS405EW","Nomis table":"NM_537_1","Cell no":[1,4,5,8,13],"Cell name":["Owned","Shared ownership","Social rented","Private rented","Living rent free"],Unit:"households"},Ta={index:[33,34,35,36,37,38],"Table name":"Number of bedrooms","Source table":"QS411EW","Nomis table":"NM_543_1","Cell no":[1,2,3,4,5,6],"Cell name":["No bedrooms","1 bedroom","2 bedrooms","3 bedrooms","4 bedrooms","5+ bedrooms"],Unit:"households"},Aa={index:[39,40,41,42],"Table name":"Persons per bedroom","Source table":"QS413EW","Nomis table":"NM_545_1","Cell no":[1,2,3,4],"Cell name":["Up to 0.5 persons","Over 0.5 and up to 1.0 persons","Over 1.0 and up to 1.5 persons","Over 1.5 persons per bedroom"],Unit:"households"},Pa={index:[43,44,45,46,47],"Table name":"Car or van availability","Source table":"QS416EW","Nomis table":"NM_548_1","Cell no":[1,2,3,4,5],"Cell name":["No cars or vans","1 car or van","2 cars or vans","3 cars or vans","4+ cars or vans"],Unit:"households"},Ua={index:[48,49,50,51,52,53,54],"Table name":"Highest qualification","Source table":"QS501EW","Nomis table":"NM_554_1","Cell no":[1,2,3,4,5,6,7],"Cell name":["No qualifications","Level 1 qualifications","Level 2 qualifications","Apprenticeship","Level 3 qualifications","Level 4 qualifications and above","Other qualifications"],Unit:"households"},Oa={index:[55,56],"Table name":"Economic activity","Source table":"QS601EW","Nomis table":"NM_556_1","Cell no":[1,10],"Cell name":["Economically active","Economically inactive"],Unit:"people"},$a={index:[57,58,59,60],"Table name":"Hours worked","Source table":"QS604EW","Nomis table":"NM_559_1","Cell no":[1,2,3,4],"Cell name":["15 hours or less","16 to 30 hours","31 to 48 hours","49 or more hours"],Unit:"people"},Ia={index:[61,62,63,64],"Table name":"Social grade","Source table":"QS611EW","Nomis table":"NM_566_1","Cell no":[1,2,3,4],"Cell name":["Grade AB","Grade C1","Grade C2","Grade DE"],Unit:"people"},Ha={index:[65,66,67,68,69],"Table name":"Length of residence","Source table":"QS803EW","Nomis table":"NM_571_1","Cell no":[1,2,3,4,5],"Cell name":["Born in the UK","Less than 2 years","2 years or more, less than 5 years","5 years or more, less than 10 years","10 years or more"],Unit:"people"},Me={NM_144_1:ya,NM_145_1:Ea,NM_522_1:wa,NM_529_1:Sa,NM_531_1:Ma,NM_534_1:ka,NM_537_1:Ca,NM_543_1:Ta,NM_545_1:Aa,NM_548_1:Pa,NM_554_1:Ua,NM_556_1:Oa,NM_559_1:$a,NM_566_1:Ia,NM_571_1:Ha};var ea={exports:{}};(function(a,r){var t=function(h){this.prime=4294967311,this.maxHash=Math.pow(2,32)-1,this.inithashvalues=function(){for(var l=0;l<this.numPerm;l++)this.hashvalues.push(this.maxHash)},this.initPermutations=function(){for(var l={},e=0;e<2;e++){for(var n=[],c=0;c<this.numPerm;c++){for(var i=this.randInt();l[i];)i=this.randInt();n.push(i),l[i]=!0}var m=["permA","permB"][e];this[m]=n}},this.update=function(l){for(var e=0;e<this.hashvalues.length;e++){var n=this.permA[e],c=this.permB[e],i=(n*this.hash(l)+c)%this.prime;i<this.hashvalues[e]&&(this.hashvalues[e]=i)}},this.hash=function(l){var e=0;if(l.length==0)return e+this.maxHash;for(var n=0;n<l.length;n++){var c=l.charCodeAt(n);e=(e<<5)-e+c,e=e&e}return e+this.maxHash},this.jaccard=function(l){if(this.hashvalues.length!=l.hashvalues.length)throw new Error("hashvalue counts differ");if(this.seed!=l.seed)throw new Error("seed values differ");for(var e=0,n=0;n<this.hashvalues.length;n++)e+=this.hashvalues[n]==l.hashvalues[n];return e/this.hashvalues.length},this.randInt=function(){var l=Math.sin(this.seed++)*this.maxHash;return Math.floor((l-Math.floor(l))*this.maxHash)};var h=h||{};this.numPerm=h.numPerm||128,this.seed=h.seed||1,this.hashvalues=[],this.permA=[],this.permB=[],this.inithashvalues(),this.initPermutations()};typeof window<"u"&&(window.Minhash=t),a.exports&&(a.exports=t)})(ea);var aa={exports:{}};(function(a,r){var t=function(h){var h=h||{};this.bandSize=h.bandSize||4,this.index={},this.insert=function(l,e){for(var n=this.getHashbands(e),c=0;c<n.length;c++){var i=n[c];Array.isArray(this.index[i])?this.index[i].push(l):this.index[i]=[l]}},this.query=function(l){for(var e={},n=this.getHashbands(l),c=0;c<n.length;c++)for(var i=n[c],m=0;m<this.index[i].length;m++)e[this.index[i][m]]=!0;return Object.keys(e)},this.getHashbands=function(l){if(l.hashbands)return l.hashbands;l.hashbands=[];for(var e=0;e<l.hashvalues.length/this.bandSize;e++){var n=e*this.bandSize,c=n+this.bandSize,i=l.hashvalues.slice(n,c);l.hashbands.push(i.join("."))}return l.hashbands}};typeof window<"u"&&(window.LshIndex=t),a.exports&&(a.exports=t)})(aa);var Ba=ea.exports,Wa=aa.exports,je={Minhash:Ba,LshIndex:Wa};function Ge(a,r,t){const d=a.slice();return d[30]=r[t],d[32]=t,d}function Ke(a){let r,t,d,h,l,e,n,c,i,m,G,u,O,U,v,K,x,re;return c=new Pe({props:{type:"download"}}),O=new Pe({props:{type:"copy"}}),{c(){r=f("nav"),t=f("div"),d=A(),h=f("div"),l=f("input"),e=A(),n=f("button"),ke(c.$$.fragment),i=f("span"),m=J("Save geography"),G=A(),u=f("button"),ke(O.$$.fragment),U=f("span"),v=J("Copy area codes"),this.h()},l(N){r=_(N,"NAV",{class:!0});var D=g(r);t=_(D,"DIV",{}),g(t).forEach(p),d=P(D),h=_(D,"DIV",{class:!0});var L=g(h);l=_(L,"INPUT",{type:!0,placeholder:!0}),e=P(L),n=_(L,"BUTTON",{class:!0});var Q=g(n);Ce(c.$$.fragment,Q),i=_(Q,"SPAN",{});var ie=g(i);m=X(ie,"Save geography"),ie.forEach(p),Q.forEach(p),G=P(L),u=_(L,"BUTTON",{class:!0});var se=g(u);Ce(O.$$.fragment,se),U=_(se,"SPAN",{});var ae=g(U);v=X(ae,"Copy area codes"),ae.forEach(p),se.forEach(p),L.forEach(p),D.forEach(p),this.h()},h(){w(l,"type","text"),w(l,"placeholder","Type a name"),w(n,"class","text"),w(u,"class","text"),w(h,"class","save-buttons"),w(r,"class","tray")},m(N,D){le(N,r,D),o(r,t),o(r,d),o(r,h),o(h,l),ve(l,a[1].name),o(h,e),o(h,n),Te(c,n,null),o(n,i),o(i,m),o(h,G),o(h,u),Te(O,u,null),o(u,U),o(U,v),K=!0,x||(re=[Y(l,"input",a[11]),Y(n,"click",a[12]),Y(u,"click",a[13])],x=!0)},p(N,D){D[0]&2&&l.value!==N[1].name&&ve(l,N[1].name)},i(N){K||(ce(c.$$.fragment,N),ce(O.$$.fragment,N),K=!0)},o(N){be(c.$$.fragment,N),be(O.$$.fragment,N),K=!1},d(N){N&&p(r),Ae(c),Ae(O),x=!1,Ze(re)}}}function Re(a){let r,t,d,h,l,e=a[8](a[30].label,a[5])+"",n,c;return{c(){r=f("label"),t=f("input"),h=A(),l=new ha(!1),this.h()},l(i){r=_(i,"LABEL",{});var m=g(r);t=_(m,"INPUT",{type:!0,name:!0}),h=P(m),l=ua(m,!1),m.forEach(p),this.h()},h(){w(t,"type","checkbox"),w(t,"name","topics"),t.__value=d=a[30],t.value=t.__value,a[18][0].push(t),l.a=null,Ie(r,"display",a[32]<6||a[1].topicsExpand?null:"none",!1)},m(i,m){le(i,r,m),o(r,t),t.checked=~a[1].topics.indexOf(t.__value),o(r,h),l.m(e,r),n||(c=Y(t,"change",a[17]),n=!0)},p(i,m){m[0]&34&&d!==(d=i[30])&&(t.__value=d,t.value=t.__value),m[0]&2&&(t.checked=~i[1].topics.indexOf(t.__value)),m[0]&34&&e!==(e=i[8](i[30].label,i[5])+"")&&l.p(e),m[0]&2&&Ie(r,"display",i[32]<6||i[1].topicsExpand?null:"none",!1)},d(i){i&&p(r),a[18][0].splice(a[18][0].indexOf(t),1),n=!1,c()}}}function ze(a){let r,t=a[1].topicsExpand?"Show fewer":`Show ${a[6].length-6} more`,d,h,l;return{c(){r=f("button"),d=J(t)},l(e){r=_(e,"BUTTON",{});var n=g(r);d=X(n,t),n.forEach(p)},m(e,n){le(e,r,n),o(r,d),h||(l=Y(r,"click",a[19]),h=!0)},p(e,n){n[0]&2&&t!==(t=e[1].topicsExpand?"Show fewer":`Show ${e[6].length-6} more`)&&Ye(d,t)},d(e){e&&p(r),h=!1,l()}}}function Je(a){let r,t,d,h,l;return{c(){r=f("p"),t=J("Embed code"),d=A(),h=f("textarea"),this.h()},l(e){r=_(e,"P",{});var n=g(r);t=X(n,"Embed code"),n.forEach(p),d=P(e),h=_(e,"TEXTAREA",{class:!0}),g(h).forEach(p),this.h()},h(){Ie(r,"margin-bottom",0,!1),h.value=l=Xe(a[3]),w(h,"class","svelte-q7mv1m")},m(e,n){le(e,r,n),o(r,t),le(e,d,n),le(e,h,n)},p(e,n){n[0]&8&&l!==(l=Xe(e[3]))&&(h.value=l)},d(e){e&&p(r),e&&p(d),e&&p(h)}}}function Da(a){let r,t,d,h,l,e,n,c,i,m,G,u,O,U,v,K,x,re,N,D,L,Q,ie,se,ae,ge,Ne,Z,ye,pe,Ee,R,b,F,C,k,ee,S,M,q=a[1].showEmbed?"Hide embed code":"Show embed code",me,ue,ne,y,j,$,oe,de,z,Ue,He;h=new Pe({props:{type:"chevron",rotation:180}}),m=new Pe({props:{type:a[1].showSave?"add":"download",rotation:a[1].showSave?45:0}});let T=a[1].showSave&&Ke(a),fe=a[7](a[6],a[1].topics,a[5],a[1].topicsExpand),I=[];for(let s=0;s<fe.length;s+=1)I[s]=Re(Ge(a,fe,s));let H=!a[5]&&ze(a),B=a[3]&&a[1].showEmbed&&Je(a);return{c(){r=f("nav"),t=f("div"),d=f("button"),ke(h.$$.fragment),l=f("span"),e=J("Edit area"),n=A(),c=f("div"),i=f("button"),ke(m.$$.fragment),u=A(),T&&T.c(),O=A(),U=f("div"),v=f("aside"),K=f("h2"),x=J("Name your area"),re=A(),N=f("input"),D=A(),L=f("label"),Q=f("input"),ie=J(`\r
			Include Map`),se=A(),ae=f("h2"),ge=J("Select topics"),Ne=A(),Z=f("input"),ye=A();for(let s=0;s<I.length;s+=1)I[s].c();pe=A(),H&&H.c(),Ee=A(),R=f("article"),b=f("h2"),F=J("Profile preview"),C=A(),k=f("div"),ee=A(),S=f("div"),M=f("button"),me=J(q),ue=A(),ne=f("button"),y=J("Download PNG"),j=A(),$=f("button"),oe=J("Download Data"),de=A(),B&&B.c(),this.h()},l(s){r=_(s,"NAV",{});var E=g(r);t=_(E,"DIV",{class:!0});var te=g(t);d=_(te,"BUTTON",{class:!0});var W=g(d);Ce(h.$$.fragment,W),l=_(W,"SPAN",{});var we=g(l);e=X(we,"Edit area"),we.forEach(p),W.forEach(p),te.forEach(p),n=P(E),c=_(E,"DIV",{class:!0});var Be=g(c);i=_(Be,"BUTTON",{title:!0});var We=g(i);Ce(m.$$.fragment,We),We.forEach(p),Be.forEach(p),E.forEach(p),u=P(s),T&&T.l(s),O=P(s),U=_(s,"DIV",{class:!0});var Se=g(U);v=_(Se,"ASIDE",{class:!0});var V=g(v);K=_(V,"H2",{});var De=g(K);x=X(De,"Name your area"),De.forEach(p),re=P(V),N=_(V,"INPUT",{type:!0,placeholder:!0}),D=P(V),L=_(V,"LABEL",{});var Oe=g(L);Q=_(Oe,"INPUT",{type:!0,name:!0}),ie=X(Oe,`\r
			Include Map`),Oe.forEach(p),se=P(V),ae=_(V,"H2",{});var Le=g(ae);ge=X(Le,"Select topics"),Le.forEach(p),Ne=P(V),Z=_(V,"INPUT",{type:!0,placeholder:!0}),ye=P(V);for(let $e=0;$e<I.length;$e+=1)I[$e].l(V);pe=P(V),H&&H.l(V),V.forEach(p),Ee=P(Se),R=_(Se,"ARTICLE",{class:!0});var _e=g(R);b=_(_e,"H2",{});var qe=g(b);F=X(qe,"Profile preview"),qe.forEach(p),C=P(_e),k=_(_e,"DIV",{id:!0}),g(k).forEach(p),ee=P(_e),S=_(_e,"DIV",{class:!0});var he=g(S);M=_(he,"BUTTON",{});var Qe=g(M);me=X(Qe,q),Qe.forEach(p),ue=P(he),ne=_(he,"BUTTON",{});var Fe=g(ne);y=X(Fe,"Download PNG"),Fe.forEach(p),j=P(he),$=_(he,"BUTTON",{});var Ve=g($);oe=X(Ve,"Download Data"),Ve.forEach(p),de=P(he),B&&B.l(he),he.forEach(p),_e.forEach(p),Se.forEach(p),this.h()},h(){w(d,"class","text"),w(t,"class","nav-left"),w(i,"title",G=a[1].showSave?"Close save options":"Save selected area"),xe(i,"active",a[1].showSave),w(c,"class","nav-right"),w(N,"type","text"),w(N,"placeholder","Type a name"),w(Q,"type","checkbox"),w(Q,"name","includemap"),w(Z,"type","text"),w(Z,"placeholder","Type to filter"),w(v,"class","topics-box"),w(k,"id","embed"),$.disabled="true",w(S,"class","embed-actions svelte-q7mv1m"),w(R,"class","profile svelte-q7mv1m"),w(U,"class","container svelte-q7mv1m")},m(s,E){le(s,r,E),o(r,t),o(t,d),Te(h,d,null),o(d,l),o(l,e),o(r,n),o(r,c),o(c,i),Te(m,i,null),le(s,u,E),T&&T.m(s,E),le(s,O,E),le(s,U,E),o(U,v),o(v,K),o(K,x),o(v,re),o(v,N),ve(N,a[1].name),o(v,D),o(v,L),o(L,Q),Q.checked=a[0],o(L,ie),o(v,se),o(v,ae),o(ae,ge),o(v,Ne),o(v,Z),ve(Z,a[1].topicsFilter),o(v,ye);for(let te=0;te<I.length;te+=1)I[te].m(v,null);o(v,pe),H&&H.m(v,null),o(U,Ee),o(U,R),o(R,b),o(b,F),o(R,C),o(R,k),o(R,ee),o(R,S),o(S,M),o(M,me),o(S,ue),o(S,ne),o(ne,y),o(S,j),o(S,$),o($,oe),o(S,de),B&&B.m(S,null),z=!0,Ue||(He=[Y(d,"click",a[9]),na(ma.call(null,i)),Y(i,"click",a[10]),Y(N,"input",a[14]),Y(Q,"change",a[15]),Y(Z,"input",a[16]),Y(M,"click",a[20]),Y(ne,"click",a[21])],Ue=!0)},p(s,E){const te={};if(E[0]&2&&(te.type=s[1].showSave?"add":"download"),E[0]&2&&(te.rotation=s[1].showSave?45:0),m.$set(te),(!z||E[0]&2&&G!==(G=s[1].showSave?"Close save options":"Save selected area"))&&w(i,"title",G),(!z||E[0]&2)&&xe(i,"active",s[1].showSave),s[1].showSave?T?(T.p(s,E),E[0]&2&&ce(T,1)):(T=Ke(s),T.c(),ce(T,1),T.m(O.parentNode,O)):T&&(ca(),be(T,1,1,()=>{T=null}),oa()),E[0]&2&&N.value!==s[1].name&&ve(N,s[1].name),E[0]&1&&(Q.checked=s[0]),E[0]&2&&Z.value!==s[1].topicsFilter&&ve(Z,s[1].topicsFilter),E[0]&482){fe=s[7](s[6],s[1].topics,s[5],s[1].topicsExpand);let W;for(W=0;W<fe.length;W+=1){const we=Ge(s,fe,W);I[W]?I[W].p(we,E):(I[W]=Re(we),I[W].c(),I[W].m(v,pe))}for(;W<I.length;W+=1)I[W].d(1);I.length=fe.length}s[5]?H&&(H.d(1),H=null):H?H.p(s,E):(H=ze(s),H.c(),H.m(v,null)),(!z||E[0]&2)&&q!==(q=s[1].showEmbed?"Hide embed code":"Show embed code")&&Ye(me,q),s[3]&&s[1].showEmbed?B?B.p(s,E):(B=Je(s),B.c(),B.m(S,null)):B&&(B.d(1),B=null)},i(s){z||(ce(h.$$.fragment,s),ce(m.$$.fragment,s),ce(T),z=!0)},o(s){be(h.$$.fragment,s),be(m.$$.fragment,s),be(T),z=!1},d(s){s&&p(r),Ae(h),Ae(m),s&&p(u),T&&T.d(s),s&&p(O),s&&p(U),ra(I,s),H&&H.d(),B&&B.d(),Ue=!1,Ze(He)}}}function Xe(a){return`<div id="profile"></div>
<script src="http://cdn.ons.gov.uk/vendor/pym/1.3.2/pym.min.js"><\/script>
<script>var pymParent = new pym.Parent("profile", "${`/embed/${a}`}", {name: "profile"});<\/script>`}function La(a,r,t){let d,h=Object.keys(Me);h=h.filter(b=>!/UK\]| - | by |\[[^K]|WA\]/.test(Me[b].name));let l=Object.fromEntries(new Map(h.map(b=>[Me[b]["Table name"],b]))),e,n,c,i=[],m=!0;const G=[{key:"population",label:"Population"},{key:"density",label:"Population density"},{key:"agemed",label:"Average (median) age"},{key:"age",label:"Age profile"},{key:"sex",label:"Sex"},{key:"ethnicity",label:"Ethnicity"},{key:"religion",label:"Religion"},{key:"marital",label:"Marital status"},{key:"qualification",label:"Highest qualification"},{key:"grade",label:"Social grade"},{key:"economic",label:"Economic activity"},{key:"travel",label:"Travel to work"},{key:"hours",label:"Hours worked"},{key:"housing",label:"Housing type"},{key:"tenure",label:"Housing tenure"},{key:"bedrooms",label:"Number of bedrooms"},{key:"occupancy",label:"Persons per bedroom"}].map(function(b){return Object.assign({},b,Me[l[b.label]])}).filter(b=>b["Nomis table"]);let u={mode:"move",radius:5,select:"add",name:"Area Name",showSave:!1,showEmbed:!1,topics:[G[1],G[2]],topicsExpand:!1,topicsFilter:""};function O(b,F,C,k){let ee=[],S=[];return b.forEach(M=>{F.includes(M)?ee.push(M):S.push(M)}),C&&(S=S.filter(M=>C.test(M.label))),[...ee,...S]}function U(b,F){return F?b.replace(F,"<mark>$&</mark>"):b}let v;async function K(){t(4,v=JSON.parse(localStorage.getItem("onsbuild"))),console.warn("build-",v),n=da(v.geometry),t(1,u.name=v.properties.name,u),t(1,u.start=!0,u);let b=v.properties;t(1,u.compressed=Object.values({...b.msoa,...b.lsoa,...b.msoa,...b.oa}).flat().join(";"),u)}ia(K);let x={};async function re(b){if(console.log(u),!u.start)return[];let F=b.map(async function(C){return C["Nomis table"]in x?x[C["Nomis table"]]:await dfd.readCSV(`https://www.nomisweb.co.uk/api/v01/dataset/${C["Nomis table"].toLowerCase()}.bulk.csv?date=latest&geography=MAKE|MyCustomArea|${u.compressed},K04000001&rural_urban=0&measures=20100&select=geography_name,cell_name,obs_value`).then(k=>k.setIndex({column:"geography"})).then(k=>{var ee={},S=k.columns.filter(M=>M.includes(":"));return S.forEach((M,q)=>{ee[M]=M.replaceAll(/[\:\;]/g," ")}),k.loc({rows:k.index.filter(M=>M),columns:S}).rename(ee,{inplace:!1})}).then(k=>{var ee=k.$columns.filter(y=>!(y.includes("count")||y.includes("All")||(y.match(/\;/g)||[]).length===1||y.includes("sum")||y.includes("Total")));k=k.loc({columns:ee});const S=C["Cell name"].map(y=>{var j=new je.Minhash;return y.match(/\w+/g).forEach($=>j.update($)),[y,j]});let M=new Map;k.$columns.forEach(y=>{const j=new je.Minhash;y.match(/\w+/g).forEach(z=>j.update(z));var $=0,oe=y;for(const z of S){var de=j.jaccard(z[1]);de>$&&($=de,oe=z[0])}M.set([oe,[y,...M.get(oe)||[]]])});let q={};M.forEach((y,j)=>{var[$,oe]=j;q[$]=k.loc({columns:oe}).sum({axis:1}).$data}),q=new dfd.DataFrame(q),q.print(),console.log(q,k);var me=q.div(q.sum(),{axis:0}),ue=[];let ne=C["Cell name"].filter(y=>q.$columns.includes(y));return dfd.toJSON(me.loc({columns:ne}),{format:"columns"}).forEach((y,j)=>{for(var $ in y)ue.push({z:["CustomArea","England and Wales"][j],pc:y[$],column:$})}),x[C["Nomis table"]]={name:C["Table name"],data:ue,embed:{nid:C["Nomis table"],did:ne.map(y=>C["Cell name"].indexOf(y)),data:[...new Uint16Array(ue.map(y=>y.pc*1e4))]}},console.error("table",x[C["Nomis table"]]),x[C["Nomis table"]]})});return console.log("rtn",F),await Promise.all(F)}async function N(b,F,C,k){b&&(i=await re(C),t(3,c=`#/?name=${btoa(F)}&tabs=${btoa(JSON.stringify(i).replaceAll("CustomArea",F))}${k?`&poly=${btoa(JSON.stringify(n))}`:""}`),e?document.getElementById("iframe").contentWindow.location.hash=c:t(2,e=new Na.Parent("embed","/embed/"+c,{name:"embed",id:"iframe"})))}const D=[[]],L=()=>fa(`${ga}/draw/`),Q=()=>t(1,u.showSave=!u.showSave,u);function ie(){u.name=this.value,t(1,u)}const se=async()=>{let b=_a(v);va(b,`${u.name}.json`)},ae=()=>ba(v.properties.oa_all.join(","),"Copied output area codes to clipboard");function ge(){u.name=this.value,t(1,u)}function Ne(){m=this.checked,t(0,m)}function Z(){u.topicsFilter=this.value,t(1,u)}function ye(){u.topics=pa(D[0],this.__value,this.checked),t(1,u)}const pe=()=>t(1,u.topicsExpand=!u.topicsExpand,u),Ee=()=>t(1,u.showEmbed=!u.showEmbed,u),R=()=>e.sendMessage("makePNG",null);return a.$$.update=()=>{a.$$.dirty[0]&2&&t(5,d=u.topicsFilter.length>1?new RegExp(u.topicsFilter,"i"):null),a.$$.dirty[0]&3&&N(u.start,u.name,u.topics,m)},[m,u,e,c,v,d,G,O,U,L,Q,ie,se,ae,ge,Ne,Z,ye,D,pe,Ee,R]}class xa extends ta{constructor(r){super(),la(this,r,La,Da,sa,{},null,[-1,-1])}}export{xa as default};
