import{S as ma,i as _a,s as fa,k as _,w as Pe,q as R,a as K,l as f,m as b,x as Oe,r as X,h as d,c as $,n as k,Q as Xe,p as ye,b as re,G as n,y as Ie,Y as ge,Z as Y,_ as va,$ as ba,f as fe,t as Ee,d as ga,u as ca,z as Ue,T as Ea,a0 as ua,o as ya,a1 as Ca,a2 as wa,g as Ma,a3 as Na}from"../../../../chunks/index-bbb59b27.js";import{I as He,t as Sa,g as ka,a as Ye,s as Aa,b as Ta,d as Ze,c as Ka}from"../../../../chunks/git-2ab0309a.js";import{b as ea}from"../../../../chunks/paths-6cd3a76e.js";import{p as $a}from"../../../../chunks/pym.v1-f680678d.js";const Pa={index:[0,1,2,3],"Table name":["Population","Density","Sex","Sex"],"Source table":"KS101EW","Nomis table":"NM_144_1","Cell no":[0,7,1,2],"Cell name":["Total population","Population density","Male","Female"],Unit:["people","people per hectare","people","people"]},Oa={index:4,"Table name":"Median age","Source table":"KS102EW","Nomis table":"NM_145_1","Cell no":[18],"Cell name":["Median age"],Unit:"years"},Ia={index:[5,6,7,8,9],"Table name":"Ethnic group","Source table":"QS201EW","Nomis table":"NM_522_1","Cell no":[100,200,300,400,500],"Cell name":["White","Mixed/multiple ethnic groups","Asian/Asian British","Black/African/Caribbean/Black British","Other ethnic group"],Unit:"people"},Ua={index:[10,11,12,13,14,15,16,17,18],"Table name":"Religion","Source table":"QS208EW","Nomis table":"NM_529_1","Cell no":[1,2,3,4,5,6,7,8,9],"Cell name":["Christian","Buddhist","Hindu","Jewish","Muslim","Sikh","Other religion","No religion","Religion not stated"],Unit:"people"},Ha={index:[19,20,21,22,23],"Table name":"General health","Source table":"QS302EW","Nomis table":"NM_531_1","Cell no":[1,2,3,4,5],"Cell name":["Very good health","Good health","Fair health","Bad health","Very bad health"],Unit:"people"},Ba={index:[24,25,26,27],"Table name":"Housing type","Source table":"QS402EW","Nomis table":"NM_534_1","Cell no":[2,6,10,11],"Cell name":["Whole house or bungalow","Flat, maisonette or apartment","Caravan/mobile home/temporary structure","Shared dwelling"],Unit:"households"},Wa={index:[28,29,30,31,32],"Table name":"Housing tenure","Source table":"QS405EW","Nomis table":"NM_537_1","Cell no":[1,4,5,8,13],"Cell name":["Owned","Shared ownership","Social rented","Private rented","Living rent free"],Unit:"households"},Da={index:[33,34,35,36,37,38],"Table name":"Number of bedrooms","Source table":"QS411EW","Nomis table":"NM_543_1","Cell no":[1,2,3,4,5,6],"Cell name":["No bedrooms","1 bedroom","2 bedrooms","3 bedrooms","4 bedrooms","5+ bedrooms"],Unit:"households"},ja={index:[39,40,41,42],"Table name":"Persons per bedroom","Source table":"QS413EW","Nomis table":"NM_545_1","Cell no":[1,2,3,4],"Cell name":["Up to 0.5 persons","Over 0.5 and up to 1.0 persons","Over 1.0 and up to 1.5 persons","Over 1.5 persons per bedroom"],Unit:"households"},La={index:[43,44,45,46,47],"Table name":"Car or van availability","Source table":"QS416EW","Nomis table":"NM_548_1","Cell no":[1,2,3,4,5],"Cell name":["No cars or vans","1 car or van","2 cars or vans","3 cars or vans","4+ cars or vans"],Unit:"households"},Va={index:[48,49,50,51,52,53,54],"Table name":"Highest qualification","Source table":"QS501EW","Nomis table":"NM_554_1","Cell no":[1,2,3,4,5,6,7],"Cell name":["No qualifications","Level 1 qualifications","Level 2 qualifications","Apprenticeship","Level 3 qualifications","Level 4 qualifications and above","Other qualifications"],Unit:"households"},Qa={index:[55,56],"Table name":"Economic activity","Source table":"QS601EW","Nomis table":"NM_556_1","Cell no":[1,10],"Cell name":["Economically active","Economically inactive"],Unit:"people"},qa={index:[57,58,59,60],"Table name":"Hours worked","Source table":"QS604EW","Nomis table":"NM_559_1","Cell no":[1,2,3,4],"Cell name":["15 hours or less","16 to 30 hours","31 to 48 hours","49 or more hours"],Unit:"people"},xa={index:[61,62,63,64],"Table name":"Social grade","Source table":"QS611EW","Nomis table":"NM_566_1","Cell no":[1,2,3,4],"Cell name":["Grade AB","Grade C1","Grade C2","Grade DE"],Unit:"people"},Fa={index:[65,66,67,68,69],"Table name":"Length of residence","Source table":"QS803EW","Nomis table":"NM_571_1","Cell no":[1,2,3,4,5],"Cell name":["Born in the UK","Less than 2 years","2 years or more, less than 5 years","5 years or more, less than 10 years","10 years or more"],Unit:"people"},$e={NM_144_1:Pa,NM_145_1:Oa,NM_522_1:Ia,NM_529_1:Ua,NM_531_1:Ha,NM_534_1:Ba,NM_537_1:Wa,NM_543_1:Da,NM_545_1:ja,NM_548_1:La,NM_554_1:Va,NM_556_1:Qa,NM_559_1:qa,NM_566_1:xa,NM_571_1:Fa};function Ja(t,r){const a="NM_1086_1";return dfd.readCSV(`https://www.nomisweb.co.uk/api/v01/dataset/${a}.data.csv?date=latest&&geography=MAKE|${r}|${t}&&c_age=MAKE%7C0_4%7C1,MAKE%7C5_9%7C2;3,MAKE%7C10_14%7C4,MAKE%7C15_19%7C5;6;7,MAKE%7C20_24%7C8,MAKE%7C25_29%7C9,MAKE%7C30_34%7C10,MAKE%7C35_39%7C11,MAKE%7C40_44%7C12,MAKE%7C45_49%7C13,MAKE%7C50_54%7C14,MAKE%7C55_59%7C15,MAKE%7C60_64%7C16,MAKE%7C65_69%7C17,MAKE%7C70_74%7C18,MAKE%7C75_79%7C19,MAKE%7C80_84%7C20,MAKE%7C85_plus%7C21&c_residence_type=0&c_sex=0&measures=20100&select=geography_code,c_age_name,obs_value`).then(h=>{var i=h.$data.map(e=>e[2]|-0),s=Math.max(...i);return[i.map(e=>parseInt(+e)),h.$data.map(e=>e[1]),i.map(e=>parseInt(+e/s*1e4))]}).then(async function(h){var i=await dfd.readCSV(`https://www.nomisweb.co.uk/api/v01/dataset/${a}.data.csv?date=latest&&geography=MAKE|England and Wales|K04000001&&c_age=MAKE%7C0_4%7C1,MAKE%7C5_9%7C2;3,MAKE%7C10_14%7C4,MAKE%7C15_19%7C5;6;7,MAKE%7C20_24%7C8,MAKE%7C25_29%7C9,MAKE%7C30_34%7C10,MAKE%7C35_39%7C11,MAKE%7C40_44%7C12,MAKE%7C45_49%7C13,MAKE%7C50_54%7C14,MAKE%7C55_59%7C15,MAKE%7C60_64%7C16,MAKE%7C65_69%7C17,MAKE%7C70_74%7C18,MAKE%7C75_79%7C19,MAKE%7C80_84%7C20,MAKE%7C85_plus%7C21&c_residence_type=0&c_sex=0&measures=20100&select=geography_code,c_age_name,obs_value`),s=i.$data.map(l=>l[2]|-0),e=Math.max(...s);return h.push(s.map(l=>parseInt(+l/e*1e4))),h})}async function aa(t){var r=await t.json();return r.obs[0].obs_value.value}async function Ga(t,r){return Object.assign({},...await Promise.all([["Population","NM_144_1",0],["Median Age","NM_145_1",18],["Population Density","NM_145_1",7]].map(async function(a){var h=`https://www.nomisweb.co.uk/api/v01/dataset/${a[1]}.data.json?date=latest&geography=MAKE|${r}|${t}&rural_urban=0&cell=${a[2]}&measures=20100&select=geography_code,obs_value`,i=`https://www.nomisweb.co.uk/api/v01/dataset/${a[1]}.data.json?date=latest&geography=MAKE|England and Wales|K04000001&rural_urban=0&cell=${a[2]}&measures=20100&select=geography_code,obs_value`,s=a[0],e=await Promise.all([fetch(h).then(aa),fetch(i).then(aa)]),l={};return l[s]=e,await l})))}var ha={exports:{}};(function(t,r){var a=function(i){this.prime=4294967311,this.maxHash=Math.pow(2,32)-1,this.inithashvalues=function(){for(var s=0;s<this.numPerm;s++)this.hashvalues.push(this.maxHash)},this.initPermutations=function(){for(var s={},e=0;e<2;e++){for(var l=[],m=0;m<this.numPerm;m++){for(var c=this.randInt();s[c];)c=this.randInt();l.push(c),s[c]=!0}var v=["permA","permB"][e];this[v]=l}},this.update=function(s){for(var e=0;e<this.hashvalues.length;e++){var l=this.permA[e],m=this.permB[e],c=(l*this.hash(s)+m)%this.prime;c<this.hashvalues[e]&&(this.hashvalues[e]=c)}},this.hash=function(s){var e=0;if(s.length==0)return e+this.maxHash;for(var l=0;l<s.length;l++){var m=s.charCodeAt(l);e=(e<<5)-e+m,e=e&e}return e+this.maxHash},this.jaccard=function(s){if(this.hashvalues.length!=s.hashvalues.length)throw new Error("hashvalue counts differ");if(this.seed!=s.seed)throw new Error("seed values differ");for(var e=0,l=0;l<this.hashvalues.length;l++)e+=this.hashvalues[l]==s.hashvalues[l];return e/this.hashvalues.length},this.randInt=function(){var s=Math.sin(this.seed++)*this.maxHash;return Math.floor((s-Math.floor(s))*this.maxHash)};var i=i||{};this.numPerm=i.numPerm||128,this.seed=i.seed||1,this.hashvalues=[],this.permA=[],this.permB=[],this.inithashvalues(),this.initPermutations()};typeof window<"u"&&(window.Minhash=a),t.exports&&(t.exports=a)})(ha);var pa={exports:{}};(function(t,r){var a=function(i){var i=i||{};this.bandSize=i.bandSize||4,this.index={},this.insert=function(s,e){for(var l=this.getHashbands(e),m=0;m<l.length;m++){var c=l[m];Array.isArray(this.index[c])?this.index[c].push(s):this.index[c]=[s]}},this.query=function(s){for(var e={},l=this.getHashbands(s),m=0;m<l.length;m++)for(var c=l[m],v=0;v<this.index[c].length;v++)e[this.index[c][v]]=!0;return Object.keys(e)},this.getHashbands=function(s){if(s.hashbands)return s.hashbands;s.hashbands=[];for(var e=0;e<s.hashvalues.length/this.bandSize;e++){var l=e*this.bandSize,m=l+this.bandSize,c=s.hashvalues.slice(l,m);s.hashbands.push(c.join("."))}return s.hashbands}};typeof window<"u"&&(window.LshIndex=a),t.exports&&(t.exports=a)})(pa);var za=ha.exports,Ra=pa.exports,ta={Minhash:za,LshIndex:Ra};function sa(t,r,a){const h=t.slice();return h[33]=r[a],h[35]=a,h}function la(t){let r,a,h,i,s,e,l,m,c,v,u,Q,I,C,g,q,Z,ce;return m=new He({props:{type:"download"}}),I=new He({props:{type:"copy"}}),{c(){r=_("nav"),a=_("div"),h=K(),i=_("div"),s=_("input"),e=K(),l=_("button"),Pe(m.$$.fragment),c=_("span"),v=R("Save geography"),u=K(),Q=_("button"),Pe(I.$$.fragment),C=_("span"),g=R("Copy area codes"),this.h()},l(E){r=f(E,"NAV",{class:!0});var U=b(r);a=f(U,"DIV",{}),b(a).forEach(d),h=$(U),i=f(U,"DIV",{class:!0});var H=b(i);s=f(H,"INPUT",{type:!0,placeholder:!0}),e=$(H),l=f(H,"BUTTON",{class:!0});var oe=b(l);Oe(m.$$.fragment,oe),c=f(oe,"SPAN",{});var ue=b(c);v=X(ue,"Save geography"),ue.forEach(d),oe.forEach(d),u=$(H),Q=f(H,"BUTTON",{class:!0});var ee=b(Q);Oe(I.$$.fragment,ee),C=f(ee,"SPAN",{});var ae=b(C);g=X(ae,"Copy area codes"),ae.forEach(d),ee.forEach(d),H.forEach(d),U.forEach(d),this.h()},h(){k(s,"type","text"),k(s,"placeholder","Type a name"),k(l,"class","text"),k(Q,"class","text"),k(i,"class","save-buttons"),k(r,"class","tray")},m(E,U){re(E,r,U),n(r,a),n(r,h),n(r,i),n(i,s),ge(s,t[1].name),n(i,e),n(i,l),Ie(m,l,null),n(l,c),n(c,v),n(i,u),n(i,Q),Ie(I,Q,null),n(Q,C),n(C,g),q=!0,Z||(ce=[Y(s,"input",t[14]),Y(l,"click",t[15]),Y(Q,"click",t[16])],Z=!0)},p(E,U){U[0]&2&&s.value!==E[1].name&&ge(s,E[1].name)},i(E){q||(fe(m.$$.fragment,E),fe(I.$$.fragment,E),q=!0)},o(E){Ee(m.$$.fragment,E),Ee(I.$$.fragment,E),q=!1},d(E){E&&d(r),Ue(m),Ue(I),Z=!1,ua(ce)}}}function oa(t){let r,a,h,i,s,e=t[8](t[33].label,t[5])+"",l,m;return{c(){r=_("label"),a=_("input"),i=K(),s=new Ca(!1),this.h()},l(c){r=f(c,"LABEL",{});var v=b(r);a=f(v,"INPUT",{type:!0,name:!0}),i=$(v),s=wa(v,!1),v.forEach(d),this.h()},h(){k(a,"type","checkbox"),k(a,"name","topics"),a.__value=h=t[33],a.value=a.__value,t[21][0].push(a),s.a=null,ye(r,"display",t[35]<6||t[1].topicsExpand?null:"none")},m(c,v){re(c,r,v),n(r,a),a.checked=~t[1].topics.indexOf(a.__value),n(r,i),s.m(e,r),l||(m=Y(a,"change",t[20]),l=!0)},p(c,v){v[0]&34&&h!==(h=c[33])&&(a.__value=h,a.value=a.__value),v[0]&2&&(a.checked=~c[1].topics.indexOf(a.__value)),v[0]&34&&e!==(e=c[8](c[33].label,c[5])+"")&&s.p(e),v[0]&2&&ye(r,"display",c[35]<6||c[1].topicsExpand?null:"none")},d(c){c&&d(r),t[21][0].splice(t[21][0].indexOf(a),1),l=!1,m()}}}function na(t){let r,a=t[1].topicsExpand?"Show fewer":`Show ${t[6].length-6} more`,h,i,s;return{c(){r=_("button"),h=R(a)},l(e){r=f(e,"BUTTON",{});var l=b(r);h=X(l,a),l.forEach(d)},m(e,l){re(e,r,l),n(r,h),i||(s=Y(r,"click",t[22]),i=!0)},p(e,l){l[0]&2&&a!==(a=e[1].topicsExpand?"Show fewer":`Show ${e[6].length-6} more`)&&ca(h,a)},d(e){e&&d(r),i=!1,s()}}}function ra(t){let r,a,h,i,s;return{c(){r=_("p"),a=R("Embed code"),h=K(),i=_("textarea"),this.h()},l(e){r=f(e,"P",{});var l=b(r);a=X(l,"Embed code"),l.forEach(d),h=$(e),i=f(e,"TEXTAREA",{class:!0}),b(i).forEach(d),this.h()},h(){ye(r,"margin-bottom",0),i.value=s=ia(t[3]),k(i,"class","svelte-1o018n")},m(e,l){re(e,r,l),n(r,a),re(e,h,l),re(e,i,l)},p(e,l){l[0]&8&&s!==(s=ia(e[3]))&&(i.value=s)},d(e){e&&d(r),e&&d(h),e&&d(i)}}}function Xa(t){let r,a,h,i,s,e,l,m,c,v,u,Q,I,C,g,q,Z,ce,E,U,H,oe,ue,ee,ae,Ce,we,_e,Me,Ne,se,Se,ve,ke,F,p,A,y,S,x,P,T,w,G,te=t[1].showEmbed?"Hide embed code":"Show embed code",J,M,B,z,ie,le,he,Te,Be,pe,We,Le;i=new He({props:{type:"chevron",rotation:180}}),v=new He({props:{type:t[1].showSave?"add":"download",rotation:t[1].showSave?45:0}});let O=t[1].showSave&&la(t),be=t[7](t[6],t[1].topics,t[5],t[1].topicsExpand),W=[];for(let o=0;o<be.length;o+=1)W[o]=oa(sa(t,be,o));let D=!t[5]&&na(t),j=t[3]&&t[1].showEmbed&&ra(t);return{c(){r=_("nav"),a=_("div"),h=_("button"),Pe(i.$$.fragment),s=_("span"),e=R("Edit area"),l=K(),m=_("div"),c=_("button"),Pe(v.$$.fragment),Q=K(),O&&O.c(),I=K(),C=_("div"),g=_("aside"),q=_("h2"),Z=R("Name your area"),ce=K(),E=_("input"),U=K(),H=_("p"),oe=R("Area Profiles"),ue=K(),ee=_("label"),ae=_("input"),Ce=R(`
      Include Map`),we=K(),_e=_("h2"),Me=R("Select topics"),Ne=K(),se=_("input"),Se=K();for(let o=0;o<W.length;o+=1)W[o].c();ve=K(),D&&D.c(),ke=K(),F=_("article"),p=_("h2"),A=R("Profile preview"),y=K(),S=_("div"),x=K(),P=_("div"),T=K(),w=_("div"),G=_("button"),J=R(te),M=K(),B=_("button"),z=R("Download PNG"),ie=K(),le=_("button"),he=R("Download Data"),Be=K(),j&&j.c(),this.h()},l(o){r=f(o,"NAV",{});var N=b(r);a=f(N,"DIV",{class:!0});var ne=b(a);h=f(ne,"BUTTON",{class:!0});var L=b(h);Oe(i.$$.fragment,L),s=f(L,"SPAN",{});var Ae=b(s);e=X(Ae,"Edit area"),Ae.forEach(d),L.forEach(d),ne.forEach(d),l=$(N),m=f(N,"DIV",{class:!0});var Ve=b(m);c=f(Ve,"BUTTON",{title:!0});var Qe=b(c);Oe(v.$$.fragment,Qe),Qe.forEach(d),Ve.forEach(d),N.forEach(d),Q=$(o),O&&O.l(o),I=$(o),C=f(o,"DIV",{class:!0});var Ke=b(C);g=f(Ke,"ASIDE",{class:!0});var V=b(g);q=f(V,"H2",{});var qe=b(q);Z=X(qe,"Name your area"),qe.forEach(d),ce=$(V),E=f(V,"INPUT",{type:!0,placeholder:!0}),U=$(V),H=f(V,"P",{style:!0});var xe=b(H);oe=X(xe,"Area Profiles"),xe.forEach(d),ue=$(V),ee=f(V,"LABEL",{});var De=b(ee);ae=f(De,"INPUT",{type:!0}),Ce=X(De,`
      Include Map`),De.forEach(d),we=$(V),_e=f(V,"H2",{});var Fe=b(_e);Me=X(Fe,"Select topics"),Fe.forEach(d),Ne=$(V),se=f(V,"INPUT",{type:!0,placeholder:!0}),Se=$(V);for(let je=0;je<W.length;je+=1)W[je].l(V);ve=$(V),D&&D.l(V),V.forEach(d),ke=$(Ke),F=f(Ke,"ARTICLE",{class:!0});var de=b(F);p=f(de,"H2",{});var Je=b(p);A=X(Je,"Profile preview"),Je.forEach(d),y=$(de),S=f(de,"DIV",{id:!0}),b(S).forEach(d),x=$(de),P=f(de,"DIV",{class:!0,style:!0});var da=b(P);da.forEach(d),T=$(de),w=f(de,"DIV",{class:!0});var me=b(w);G=f(me,"BUTTON",{});var Ge=b(G);J=X(Ge,te),Ge.forEach(d),M=$(me),B=f(me,"BUTTON",{});var ze=b(B);z=X(ze,"Download PNG"),ze.forEach(d),ie=$(me),le=f(me,"BUTTON",{});var Re=b(le);he=X(Re,"Download Data"),Re.forEach(d),Be=$(me),j&&j.l(me),me.forEach(d),de.forEach(d),Ke.forEach(d),this.h()},h(){k(h,"class","text"),k(a,"class","nav-left"),k(c,"title",u=t[1].showSave?"Close save options":"Save selected area"),Xe(c,"active",t[1].showSave),k(m,"class","nav-right"),k(E,"type","text"),k(E,"placeholder","Type a name"),ye(H,"font-weight","bold"),k(ae,"type","checkbox"),k(se,"type","text"),k(se,"placeholder","Type to filter"),k(g,"class","topics-box"),k(S,"id","embed"),k(P,"class","embed svelte-1o018n"),ye(P,"height",".08em",1),ye(P,"padding","0"),le.disabled=Te=!t[1].topics,k(w,"class","embed-actions svelte-1o018n"),k(F,"class","profile svelte-1o018n"),k(C,"class","container svelte-1o018n")},m(o,N){re(o,r,N),n(r,a),n(a,h),Ie(i,h,null),n(h,s),n(s,e),n(r,l),n(r,m),n(m,c),Ie(v,c,null),re(o,Q,N),O&&O.m(o,N),re(o,I,N),re(o,C,N),n(C,g),n(g,q),n(q,Z),n(g,ce),n(g,E),ge(E,t[1].name),n(g,U),n(g,H),n(H,oe),n(g,ue),n(g,ee),n(ee,ae),ae.checked=t[0],n(ee,Ce),n(g,we),n(g,_e),n(_e,Me),n(g,Ne),n(g,se),ge(se,t[1].topicsFilter),n(g,Se);for(let ne=0;ne<W.length;ne+=1)W[ne].m(g,null);n(g,ve),D&&D.m(g,null),n(C,ke),n(C,F),n(F,p),n(p,A),n(F,y),n(F,S),n(F,x),n(F,P),n(F,T),n(F,w),n(w,G),n(G,J),n(w,M),n(w,B),n(B,z),n(w,ie),n(w,le),n(le,he),n(w,Be),j&&j.m(w,null),pe=!0,We||(Le=[Y(h,"click",t[12]),va(Sa.call(null,c)),Y(c,"click",t[13]),Y(E,"input",t[17]),Y(ae,"change",t[18]),Y(se,"input",t[19]),Y(G,"click",ba(t[23])),Y(B,"click",t[24]),Y(le,"click",t[25])],We=!0)},p(o,N){const ne={};if(N[0]&2&&(ne.type=o[1].showSave?"add":"download"),N[0]&2&&(ne.rotation=o[1].showSave?45:0),v.$set(ne),(!pe||N[0]&2&&u!==(u=o[1].showSave?"Close save options":"Save selected area"))&&k(c,"title",u),(!pe||N[0]&2)&&Xe(c,"active",o[1].showSave),o[1].showSave?O?(O.p(o,N),N[0]&2&&fe(O,1)):(O=la(o),O.c(),fe(O,1),O.m(I.parentNode,I)):O&&(Ma(),Ee(O,1,1,()=>{O=null}),ga()),N[0]&2&&E.value!==o[1].name&&ge(E,o[1].name),N[0]&1&&(ae.checked=o[0]),N[0]&2&&se.value!==o[1].topicsFilter&&ge(se,o[1].topicsFilter),N[0]&482){be=o[7](o[6],o[1].topics,o[5],o[1].topicsExpand);let L;for(L=0;L<be.length;L+=1){const Ae=sa(o,be,L);W[L]?W[L].p(Ae,N):(W[L]=oa(Ae),W[L].c(),W[L].m(g,ve))}for(;L<W.length;L+=1)W[L].d(1);W.length=be.length}o[5]?D&&(D.d(1),D=null):D?D.p(o,N):(D=na(o),D.c(),D.m(g,null)),(!pe||N[0]&2)&&te!==(te=o[1].showEmbed?"Hide embed code":"Show embed code")&&ca(J,te),(!pe||N[0]&2&&Te!==(Te=!o[1].topics))&&(le.disabled=Te),o[3]&&o[1].showEmbed?j?j.p(o,N):(j=ra(o),j.c(),j.m(w,null)):j&&(j.d(1),j=null)},i(o){pe||(fe(i.$$.fragment,o),fe(v.$$.fragment,o),fe(O),pe=!0)},o(o){Ee(i.$$.fragment,o),Ee(v.$$.fragment,o),Ee(O),pe=!1},d(o){o&&d(r),Ue(i),Ue(v),o&&d(Q),O&&O.d(o),o&&d(I),o&&d(C),Ea(W,o),D&&D.d(),j&&j.d(),We=!1,ua(Le)}}}function ia(t){return`<div id="profile"></div>
<script src="http://cdn.ons.gov.uk/vendor/pym/1.3.2/pym.min.js"><\/script>
<script>var pymParent = new pym.Parent("profile", "${`/embed/${t}`}", {name: "profile"});<\/script>`}function Ya(t,r,a){let h,i=Object.keys($e);i=i.filter(p=>!/UK\]| - | by |\[[^K]|WA\]/.test($e[p].name));let s=Object.fromEntries(new Map(i.map(p=>[$e[p]["Table name"],p]))),e,l,m=[],c=!0,v=[{key:"population",label:"Total Population",special:!0},{key:"density",label:"Population density",special:!0},{key:"agemed",label:"Median age",special:!0},{key:"age",label:"Age profile",special:!0},{key:"ethnicity",label:"Ethnicity"},{key:"religion",label:"Religion"},{key:"marital",label:"Marital status"},{key:"qualification",label:"Highest qualification"},{key:"grade",label:"Social grade"},{key:"economic",label:"Economic activity"},{key:"travel",label:"Travel to work"},{key:"hours",label:"Hours worked"},{key:"housing",label:"Housing type"},{key:"tenure",label:"Housing tenure"},{key:"bedrooms",label:"Number of bedrooms"},{key:"occupancy",label:"Persons per bedroom"}].map(function(p){return Object.assign({},p,$e[s[p.label]])}).filter(p=>p["Nomis table"]||p.special);v.sort((p,A)=>p.key>A.key?1:-1);let u={mode:"move",radius:5,select:"add",name:"Area Name",showSave:!1,showEmbed:!1,topics:v.filter(p=>["population","hours"].includes(p.key)),topicsExpand:!1,topicsFilter:""};function Q(p,A,y,S){let x=[],P=[];return p.forEach(T=>{A.includes(T)?x.push(T):P.push(T)}),y&&(P=P.filter(T=>y.test(T.label))),[...x,...P]}function I(p,A){return A?p.replace(A,"<mark>$&</mark>"):p}let C,g,q,Z;async function ce(){document.body.style.opacity=.1;let p=window.location.hash;if(p="#undefined")p="",window.location.hash="";else if(p.length==10){let y=p.slice(1),S=await ka("ONSvisual","cp-places-data",`${y.slice(0,3)}/${y}.json`);if(S.type==="Feature"){const x={compressed:y,geojson:S,name:S.properties.areanm,properties:{oa_all:S.properties.codes}};localStorage.setItem("onsbuild",JSON.stringify(x))}}a(4,C=JSON.parse(localStorage.getItem("onsbuild"))),console.debug("build-",C),C||(alert("Warning, no area selected! Redirecting to the drawing page."),Ye(`${ea}/draw/`)),g=Aa(C.geojson.geometry),a(1,u.name=C.properties.name,u),a(1,u.start=!0,u);let A=C.properties;a(1,u.compressed=C.compressed||Object.values({...A.msoa,...A.lsoa,...A.oa}).flat().join(";"),u),a(10,q=await Ja(u.compressed,u.name)),a(11,Z=await Ga(u.compressed,u.name)),setTimeout(()=>{H(u.start,u.name,u.topics,c,q,Z),document.body.style.opacity=1},2e3)}ya(ce);let E={};async function U(p){if(!u.start)return[];let A=p.filter(y=>!y.special).map(async function(y){return y["Nomis table"]in E?E[y["Nomis table"]]:await dfd.readCSV(`https://www.nomisweb.co.uk/api/v01/dataset/${y["Nomis table"].toLowerCase()}.bulk.csv?date=latest&geography=MAKE|MyCustomArea|${u.compressed},K04000001&rural_urban=0&measures=20100&select=geography_name,cell_name,obs_value`).then(S=>S.setIndex({column:"geography"})).then(S=>{var x={},P=S.columns.filter(T=>T.includes(":"));return P.forEach((T,w)=>{x[T]=T.replaceAll(/[\:\;]/g," ")}),S.loc({rows:S.index.filter(T=>T),columns:P}).rename(x,{inplace:!1})}).then(S=>{var x=S.$columns.filter(M=>!(M.includes("count")||M.includes("All")||(M.match(/\;/g)||[]).length===1||M.includes("sum")||M.includes("Total")));S=S.loc({columns:x});const P=y["Cell name"].map(M=>{var B=new ta.Minhash;return M.match(/\w+/g).forEach(z=>B.update(z)),[M,B]});let T=new Map;S.$columns.forEach(M=>{const B=new ta.Minhash;M.match(/\w+/g).forEach(he=>B.update(he));var z=0,ie=M;for(const he of P){var le=B.jaccard(he[1]);le>z&&(z=le,ie=he[0])}T.set([ie,[M,...T.get(ie)||[]]])});let w={};T.forEach((M,B)=>{var[z,ie]=B;w[z]=S.loc({columns:ie}).sum({axis:1}).$data}),w=new dfd.DataFrame(w);var G=w.div(w.sum(),{axis:0}),te=[];let J=y["Cell name"].filter(M=>w.$columns.includes(M));return dfd.toJSON(G.loc({columns:J}),{format:"columns"}).forEach((M,B)=>{for(var z in M)te.push({z:["CustomArea","England and Wales"][B],pc:M[z],column:z})}),E[y["Nomis table"]]={name:y["Table name"],data:te,embed:{nid:y["Nomis table"],did:J.map(M=>y["Cell name"].indexOf(M)),data:[...new Uint16Array(te.map(M=>M.pc*1e4))]}},E[y["Nomis table"]]})});return await Promise.all(A)}async function H(p,A,y,S,x,P){if(p){var T=JSON.parse(localStorage.getItem("onsbuild"));T.properties.name=A,localStorage.setItem("onsbuild",JSON.stringify(T)),m=await U(y);let te;var w=[];if(P){var G=y.filter(J=>J.special).map(J=>J.key);G.includes("population")&&w.push("Population"),G.includes("agemed")&&w.push("Median Age"),G.includes("density")&&w.push("Population Density"),te=w.map(J=>[J,P[J]])}a(3,l=`#/?name=${btoa(A)}&tabs=${btoa(JSON.stringify(m).replaceAll("CustomArea",A))}${G||[].includes("age")?`&population=${btoa(JSON.stringify(x))}`:""}${w.length>0?`&stats=${btoa(JSON.stringify(te))}`:""}${S?`&poly=${btoa(JSON.stringify(g))}`:""}`),e?document.getElementById("iframe").contentWindow.location.hash=l:a(2,e=new $a.Parent("embed","/embed/"+l,{name:"embed",id:"iframe"}))}}const oe=[[]],ue=()=>Ye(`${ea}/draw/${"#"+(C.compressed||"")}`),ee=()=>a(1,u.showSave=!u.showSave,u);function ae(){u.name=this.value,a(1,u)}const Ce=async()=>{let p=Ta(C);Ze(p,`${u.name}.json`)},we=()=>Ka(C.properties.oa_all.join(","),"Copied output area codes to clipboard");function _e(){u.name=this.value,a(1,u)}function Me(){c=this.checked,a(0,c)}function Ne(){u.topicsFilter=this.value,a(1,u)}function se(){u.topics=Na(oe[0],this.__value,this.checked),a(1,u)}const Se=()=>a(1,u.topicsExpand=!u.topicsExpand,u),ve=()=>{a(1,u.showEmbed=!u.showEmbed,u),setTimeout(()=>{const p=document.querySelector("textarea");!p||p.scrollIntoView({behavior:"smooth"})})},ke=()=>e.sendMessage("makePNG",null),F=async function(){var p=await U(u.topics),A=JSON.stringify(p,null,4),y=new Blob([A],{type:"text/json"});Ze(y,u.name.replace(" ","_")+".json"),console.log(A)};return t.$$.update=()=>{t.$$.dirty[0]&2&&a(5,h=u.topicsFilter.length>1?new RegExp(u.topicsFilter,"i"):null),t.$$.dirty[0]&3075&&H(u.start,u.name,u.topics,c,q,Z)},[c,u,e,l,C,h,v,Q,I,U,q,Z,ue,ee,ae,Ce,we,_e,Me,Ne,se,oe,Se,ve,ke,F]}class st extends ma{constructor(r){super(),_a(this,r,Ya,Xa,fa,{},null,[-1,-1])}}export{st as default};
